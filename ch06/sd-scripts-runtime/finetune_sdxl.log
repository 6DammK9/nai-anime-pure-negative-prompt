>accelerate launch --num_cpu_threads_per_process 8 sdxl_train.py    --pretrained_model_name_or_path="F:/NOVELAI/astolfo_mix/sdxl/cmp/x215c-AstolfoMix-24101101-6e545a3.safetensors"    --in_json "H:/just_astolfo/meta_lat.json"    --train_data_dir="H:/just_astolfo/khoyas_finetune"    --output_dir="F:/NOVELAI/astolfo_xl/just_astolfo/finetune_job"    --save_model_as=safetensors    --caption_extension=".txt"    --use_8bit_adam    --train_batch_size=1 --learning_rate=4e-7 --max_train_steps=10000     --xformers --diffusers_xformers --gradient_checkpointing    --full_bf16 --mixed_precision=bf16 --save_precision=fp16    --enable_bucket --cache_latents    --save_every_n_epochs=1
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
2024-12-08 18:19:49 INFO     prepare tokenizers                                                                                                                                                                                                                        sdxl_train_util.py:1342024-12-08 18:19:50 INFO     Training with captions.                                                                                                                                                                                                                        sdxl_train.py:155                    INFO     loading existing metadata: H:/just_astolfo/meta_lat.json                                                                                                                                                                                      train_util.py:16792024-12-08 18:19:55 INFO     using bucket info in metadata / メタデータ内のbucket情報を使います                                                                                                                                                                            train_util.py:1822                    INFO     [Dataset 0]                                                                                                                                                                                                                                   config_util.py:565                               batch_size: 1
                               resolution: (None, None)
                               enable_bucket: True
                               network_multiplier: 1.0
                               min_bucket_reso: None
                               max_bucket_reso: None
                               bucket_reso_steps: None
                               bucket_no_upscale: None

                               [Subset 0 of Dataset 0]
                                 image_dir: "H:/just_astolfo/khoyas_finetune"
                                 image_count: 6224
                                 num_repeats: 1
                                 shuffle_caption: False
                                 keep_tokens: 0
                                 keep_tokens_separator:
                                 secondary_separator: None
                                 enable_wildcard: False
                                 caption_dropout_rate: 0.0
                                 caption_dropout_every_n_epoches: 0
                                 caption_tag_dropout_rate: 0.0
                                 caption_prefix: None
                                 caption_suffix: None
                                 color_aug: False
                                 flip_aug: False
                                 face_crop_aug_range: None
                                 random_crop: False
                                 token_warmup_min: 1,
                                 token_warmup_step: 0,
                                 metadata_file: H:/just_astolfo/meta_lat.json


                    INFO     [Dataset 0]                                                                                                                                                                                                                                   config_util.py:571                    INFO     loading image sizes.                                                                                                                                                                                                                           train_util.py:853100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6224/6224 [00:00<00:00, 6236346.89it/s] 
                    INFO     make buckets                                                                                                                                                                                                                                   train_util.py:859                    INFO     number of images (including repeats) / 各bucketの画像枚数（繰り返し回数を含む）                                                                                                                                                                train_util.py:905                    INFO     bucket 0: resolution (256, 1024), count: 16                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 1: resolution (320, 1024), count: 13                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 2: resolution (384, 1024), count: 23                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 3: resolution (448, 1024), count: 29                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 4: resolution (512, 1024), count: 71                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 5: resolution (576, 1024), count: 204                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 6: resolution (640, 1024), count: 479                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 7: resolution (704, 1024), count: 2279                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 8: resolution (768, 1024), count: 746                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 9: resolution (832, 1024), count: 371                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 10: resolution (896, 1024), count: 230                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 11: resolution (960, 1024), count: 177                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 12: resolution (1024, 256), count: 5                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 13: resolution (1024, 320), count: 9                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 14: resolution (1024, 384), count: 4                                                                                                                                                                                                    train_util.py:910                    INFO     bucket 15: resolution (1024, 448), count: 11                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 16: resolution (1024, 512), count: 29                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 17: resolution (1024, 576), count: 89                                                                                                                                                                                                   train_util.py:910                    INFO     bucket 18: resolution (1024, 640), count: 139                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 19: resolution (1024, 704), count: 418                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 20: resolution (1024, 768), count: 203                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 21: resolution (1024, 832), count: 156                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 22: resolution (1024, 896), count: 124                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 23: resolution (1024, 960), count: 114                                                                                                                                                                                                  train_util.py:910                    INFO     bucket 24: resolution (1024, 1024), count: 285                                                                                                                                                                                                 train_util.py:910                    INFO     mean ar error (without repeats): 0.0                                                                                                                                                                                                           train_util.py:915                    INFO     prepare accelerator                                                                                                                                                                                                                            sdxl_train.py:201accelerator device: cuda
                    INFO     loading model for process 0/1                                                                                                                                                                                                              sdxl_train_util.py:30                    INFO     load StableDiffusion checkpoint: F:/NOVELAI/astolfo_mix/sdxl/cmp/x215c-AstolfoMix-24101101-6e545a3.safetensors                                                                                                                             sdxl_train_util.py:70                    INFO     building U-Net                                                                                                                                                                                                                            sdxl_model_util.py:1922024-12-08 18:19:56 INFO     loading U-Net from checkpoint                                                                                                                                                                                                             sdxl_model_util.py:1962024-12-08 18:19:59 INFO     U-Net: <All keys matched successfully>                                                                                                                                                                                                    sdxl_model_util.py:202                    INFO     building text encoders                                                                                                                                                                                                                    sdxl_model_util.py:205                    INFO     loading text encoders from checkpoint                                                                                                                                                                                                     sdxl_model_util.py:258                    INFO     text encoder 1: <All keys matched successfully>                                                                                                                                                                                           sdxl_model_util.py:2722024-12-08 18:20:00 INFO     text encoder 2: <All keys matched successfully>                                                                                                                                                                                           sdxl_model_util.py:276                    INFO     building VAE                                                                                                                                                                                                                              sdxl_model_util.py:2792024-12-08 18:20:01 INFO     loading VAE from checkpoint                                                                                                                                                                                                               sdxl_model_util.py:284                    INFO     VAE: <All keys matched successfully>                                                                                                                                                                                                      sdxl_model_util.py:287Use xformers by Diffusers
                    INFO     [Dataset 0]                                                                                                                                                                                                                                   train_util.py:2079                    INFO     caching latents.                                                                                                                                                                                                                               train_util.py:974                    INFO     checking cache validity...                                                                                                                                                                                                                     train_util.py:984100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 6224/6224 [00:00<00:00, 692614.90it/s] 
                    INFO     caching latents...                                                                                                                                                                                                                            train_util.py:10210it [00:00, ?it/s]
train unet: True, text_encoder1: False, text_encoder2: False
number of models: 1
number of trainable parameters: 2567463684
prepare optimizer, data loader etc.
2024-12-08 18:20:02 INFO     use 8-bit AdamW optimizer | {}                                                                                                                                                                                                                train_util.py:3889enable full bf16 training.
running training / 学習開始
  num examples / サンプル数: 6224
  num batches per epoch / 1epochのバッチ数: 6224
  num epochs / epoch数: 2
  batch size per device / バッチサイズ: 1
  gradient accumulation steps / 勾配を合計するステップ数 = 1
  total optimization steps / 学習ステップ数: 10000
steps:   0%|                                                                                                                                                                                                                                                      | 0/10000 [00:00<?, ?it/s] 
epoch 1/2
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:441: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\transformers\utils\generic.py:309: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  _torch_pytree._register_pytree_node(
C:\Users\User\.conda\envs\khoyas-env\Lib\site-packages\diffusers\utils\outputs.py:63: FutureWarning: `torch.utils._pytree._register_pytree_node` is deprecated. Please use `torch.utils._pytree.register_pytree_node` instead.
  torch.utils._pytree._register_pytree_node(
steps: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [3:17:44<00:00,  1.19s/it, avr_loss=0.109]
2024-12-08 21:37:49 INFO     save trained model as StableDiffusion checkpoint to F:/NOVELAI/astolfo_xl/just_astolfo/finetune_job\last.safetensors                                                                                                                         train_util.py:4851 
2024-12-08 21:38:08 INFO     model saved.                                                                                                                                                                                                                                  sdxl_train.py:761
steps: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 10000/10000 [3:18:04<00:00,  1.19s/it, avr_loss=0.109]